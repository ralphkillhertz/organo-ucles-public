<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Órgano de Uclés — Timeline del Proyecto</title>
<style>
  *, *::before, *::after { box-sizing: border-box; }
  :root {
    --indigo: #1A237E; --mid: #3949AB; --light: #C5CAE9;
    --bg: #E8EAF6; --hoy: #F44336; --texto: #212121;
    --texto2: #757575; --fondo: #FAFAFA; --surface: #FFFFFF;
    --hito-color: #7B1FA2; --res-color: #00695C;
  }
  body {
    font-family: Arial, Helvetica, sans-serif;
    background: var(--fondo); color: var(--texto);
    margin: 0; padding: 0;
  }

  /* ── Header ── */
  .header {
    background: linear-gradient(135deg, #1A237E 0%, #283593 100%);
    color: white; padding: 28px 32px 20px;
  }
  .header h1 { font-size: 1.6rem; font-weight: 400; margin: 0 0 4px; letter-spacing: 0.02em; }
  .header h1 b { font-weight: 700; }
  .header p { font-size: 0.85rem; color: #C5CAE9; margin: 0; }

  /* ── Stats ── */
  .stats {
    display: flex; flex-wrap: wrap; gap: 12px;
    padding: 20px 32px; background: white;
    border-bottom: 1px solid #E0E0E0;
  }
  .stat-card {
    background: var(--bg); border-radius: 8px;
    padding: 12px 20px; min-width: 150px; flex: 1;
  }
  .stat-card .num { font-size: 1.5rem; font-weight: 700; color: var(--indigo); }
  .stat-card .label { font-size: 0.72rem; color: var(--texto2); text-transform: uppercase; letter-spacing: 0.04em; }

  /* ── Tabs ── */
  .tabs {
    display: flex; gap: 0; background: white;
    border-bottom: 2px solid #E0E0E0; padding: 0 32px;
  }
  .tab {
    padding: 10px 20px; cursor: pointer; font-size: 0.82rem; font-weight: 500;
    color: var(--texto2); border-bottom: 2px solid transparent;
    margin-bottom: -2px; transition: all 0.2s;
  }
  .tab:hover { color: var(--indigo); }
  .tab.ac { color: var(--indigo); border-bottom-color: var(--indigo); }

  /* ── Content ── */
  .content { padding: 24px 32px; display: none; }
  .content.ac { display: block; }

  /* ── Gantt ── */
  .gantt-wrap {
    background: white; border-radius: 8px; padding: 20px;
    box-shadow: 0 2px 12px rgba(26,35,126,0.08); overflow-x: auto;
  }
  .gantt-title { font-size: 1rem; color: var(--indigo); margin: 0 0 16px; font-weight: 400; }

  .gantt-axis {
    display: flex; margin-left: 200px; margin-bottom: 6px; min-width: 800px;
  }
  .gantt-axis-label {
    flex: 1; font-size: 0.65rem; color: #9E9E9E;
    text-align: center; border-left: 1px solid #ECEFF1; padding-top: 3px;
  }
  .gantt-axis-label.year {
    font-weight: 600; color: var(--indigo); font-size: 0.72rem;
    border-left: 2px solid var(--light);
  }

  .gantt-row {
    display: flex; align-items: center; margin-bottom: 6px; min-width: 1000px;
  }
  .gantt-label {
    width: 195px; flex-shrink: 0; font-size: 0.78rem;
    color: #283593; padding-right: 8px; text-align: right; line-height: 1.3;
  }
  .gantt-label small { display: block; font-size: 0.65rem; color: var(--texto2); font-weight: 400; }
  .gantt-bar-track { flex: 1; position: relative; height: 34px; }

  .gantt-bar {
    position: absolute; top: 7px; height: 20px; border-radius: 4px;
    font-size: 0.68rem; display: flex; align-items: center;
    padding: 0 8px; white-space: nowrap; overflow: hidden;
    cursor: pointer; transition: opacity 0.2s;
  }
  .gantt-bar:hover { opacity: 0.85 !important; }
  .gantt-bar.completada { background: var(--indigo); color: white; }
  .gantt-bar.en_curso { background: var(--mid); color: white; }
  .gantt-bar.planificada { background: var(--light); color: var(--indigo); }

  /* Hito bars */
  .gantt-bar.hito-bar {
    background: var(--hito-color); color: white;
    height: 18px; top: 8px; border-radius: 3px;
    font-size: 0.66rem; font-weight: 600;
  }
  .gantt-bar.hito-bar.completada { background: #4A148C; }
  .gantt-bar.hito-bar.en_curso { background: var(--hito-color); }
  .gantt-bar.hito-bar.planificada { background: #CE93D8; color: #4A148C; }

  /* Residencia bars */
  .gantt-bar.res-bar {
    background: var(--res-color); color: white;
    height: 18px; top: 8px; border-radius: 3px;
    font-size: 0.66rem;
  }
  .gantt-bar.res-bar.planificada { background: #80CBC4; color: #004D40; }

  .gantt-hoy {
    position: absolute; top: 0; bottom: 0; width: 2px; z-index: 10;
    background: repeating-linear-gradient(to bottom, var(--hoy) 0, var(--hoy) 6px, transparent 6px, transparent 10px);
    pointer-events: none;
  }

  .gantt-diamond {
    position: absolute; top: -1px; transform: translateX(-50%);
    font-size: 0.75rem; color: var(--hito-color); cursor: pointer; z-index: 5;
    line-height: 34px; text-shadow: 0 0 2px rgba(255,255,255,0.9);
  }
  .gantt-diamond:hover::after {
    content: attr(data-tooltip); position: absolute; top: -24px; left: 50%;
    transform: translateX(-50%); background: var(--hito-color); color: white;
    padding: 3px 8px; border-radius: 4px; white-space: nowrap;
    font-size: 0.68rem; z-index: 20; box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }

  .gantt-legend {
    display: flex; gap: 20px; margin-top: 16px; font-size: 0.75rem; flex-wrap: wrap;
  }
  .legend-item { display: flex; align-items: center; gap: 6px; }
  .legend-dot { width: 14px; height: 14px; border-radius: 3px; }

  /* ── Separator ── */
  .gantt-sep {
    display: flex; align-items: center; min-width: 1000px;
    margin: 12px 0 8px; padding-left: 200px;
  }
  .gantt-sep span {
    font-size: 0.7rem; color: var(--mid); font-weight: 600;
    text-transform: uppercase; letter-spacing: 0.06em; padding-right: 12px;
  }
  .gantt-sep hr { flex: 1; border: none; border-top: 1px dashed var(--light); }

  /* ── Info Modal ── */
  .modal-overlay {
    display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.4); z-index: 1000;
    justify-content: center; align-items: center;
  }
  .modal-overlay.visible { display: flex; }
  .modal {
    background: white; border-radius: 12px; padding: 28px 32px;
    max-width: 520px; width: 90%; box-shadow: 0 8px 40px rgba(0,0,0,0.25);
    position: relative;
  }
  .modal-close {
    position: absolute; top: 12px; right: 16px;
    background: none; border: none; font-size: 1.4rem;
    color: var(--texto2); cursor: pointer; line-height: 1;
  }
  .modal-close:hover { color: var(--texto); }
  .modal-tag {
    display: inline-block; padding: 3px 10px; border-radius: 12px;
    font-size: 0.7rem; font-weight: 600; margin-bottom: 10px;
  }
  .modal h3 { color: var(--indigo); font-size: 1.1rem; margin: 0 0 8px; font-weight: 600; }
  .modal .dates { color: var(--texto2); font-size: 0.82rem; margin-bottom: 12px; }
  .modal .desc { font-size: 0.88rem; line-height: 1.6; color: var(--texto); }
  .modal .entregables { margin-top: 12px; padding-top: 12px; border-top: 1px solid #E0E0E0; }
  .modal .entregables h4 { font-size: 0.78rem; color: var(--indigo); margin: 0 0 6px; text-transform: uppercase; letter-spacing: 0.04em; }
  .modal .entregables p { font-size: 0.82rem; color: var(--texto); line-height: 1.5; margin: 0; }

  /* ── Milestones table ── */
  table { width: 100%; border-collapse: collapse; font-size: 0.82rem; }
  th {
    background: var(--bg); padding: 8px 12px; text-align: left;
    font-weight: 600; color: var(--indigo); font-size: 0.72rem;
    text-transform: uppercase; letter-spacing: 0.04em;
  }
  td { padding: 7px 12px; border-bottom: 1px solid #ECEFF1; }
  tr:hover { background: #F5F5F5; }
  tr { cursor: pointer; }
  .badge {
    display: inline-block; padding: 2px 8px; border-radius: 10px;
    font-size: 0.68rem; font-weight: 600;
  }
  .badge.done { background: var(--indigo); color: white; }
  .badge.now { background: var(--mid); color: white; }
  .badge.plan { background: var(--light); color: var(--indigo); }

  /* ── Residencies ── */
  .res-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 12px; }
  .res-card {
    background: white; border-radius: 8px; padding: 16px;
    border-left: 4px solid var(--mid); box-shadow: 0 1px 4px rgba(0,0,0,0.06);
    cursor: pointer; transition: box-shadow 0.2s;
  }
  .res-card:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.12); }
  .res-card h4 { font-size: 0.88rem; color: var(--indigo); margin: 0 0 6px; font-weight: 500; }
  .res-card p { font-size: 0.78rem; color: var(--texto2); margin: 0; line-height: 1.5; }
  .res-card .tag { font-size: 0.68rem; color: var(--mid); font-weight: 600; }

  /* ── Footer ── */
  .footer {
    text-align: center; padding: 20px 32px; color: var(--texto2);
    font-size: 0.72rem; border-top: 1px solid #E0E0E0; margin-top: 20px;
  }
</style>
</head>
<body>

<div class="header">
  <h1><b>Órgano de Uclés</b></h1>
  <p style="font-size:0.95rem;color:#9FA8DA;margin:0 0 6px">VITRAENON · Tecnología sonora: síntesis, espacialización y control</p>
  <p>Timeline del Proyecto · Generado <span id="fecha"></span></p>
</div>

<div class="stats">
  <div class="stat-card"><div class="num">36</div><div class="label">Meses totales</div></div>
  <div class="stat-card"><div class="num">3</div><div class="label">Fases principales</div></div>
  <div class="stat-card"><div class="num">9</div><div class="label">Hitos (H-1 a H7)</div></div>
  <div class="stat-card"><div class="num">3</div><div class="label">Vías de síntesis</div></div>
  <div class="stat-card"><div class="num">8</div><div class="label">Residencias artísticas</div></div>
  <div class="stat-card"><div class="num">2</div><div class="label">Espacialización (VBAP + WFS)</div></div>
</div>

<div class="tabs">
  <div class="tab ac" onclick="T('gantt')">Gantt</div>
  <div class="tab" onclick="T('hitos')">Hitos</div>
  <div class="tab" onclick="T('residencias')">Residencias</div>
  <div class="tab" onclick="T('eventos')">Eventos públicos</div>
</div>

<!-- ═══ TAB: GANTT ═══ -->
<div id="gantt" class="content ac">
<div class="gantt-wrap">
  <div class="gantt-title">Planificación integrada: Eje Técnico + Eje Artístico + Hitos (Nov 2025 – Ene 2029)</div>
  <div class="gantt-axis" id="axis"></div>
  <div id="gantt-chart"></div>
  <div class="gantt-legend">
    <div class="legend-item"><div class="legend-dot" style="background:var(--indigo)"></div>Completado</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--mid)"></div>En curso</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--light);border:1px solid #9FA8DA"></div>Planificado</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--hito-color)"></div>Hito (H)</div>
    <div class="legend-item"><div class="legend-dot" style="background:var(--res-color)"></div>Residencia (R)</div>
    <div class="legend-item"><div style="color:var(--hito-color);font-size:1rem;width:14px;text-align:center">◆</div>Hito (posición exacta)</div>
    <div class="legend-item"><div style="width:14px;height:14px;background:repeating-linear-gradient(to bottom,var(--hoy) 0,var(--hoy) 3px,transparent 3px,transparent 5px)"></div>Hoy</div>
  </div>
</div>
</div>

<!-- ═══ TAB: HITOS ═══ -->
<div id="hitos" class="content">
<table>
<thead><tr><th>Hito</th><th>Nombre</th><th>Fecha</th><th>Estado</th><th>Entregables clave</th></tr></thead>
<tbody id="hitos-tbody"></tbody>
</table>
</div>

<!-- ═══ TAB: RESIDENCIAS ═══ -->
<div id="residencias" class="content">
<h3 style="color:var(--indigo);font-weight:400;margin:0 0 16px">Programa de residencias artísticas</h3>
<div class="res-grid" id="res-grid"></div>
</div>

<!-- ═══ TAB: EVENTOS ═══ -->
<div id="eventos" class="content">
<table>
<thead><tr><th>Evento</th><th>Fecha</th><th>Descripción</th><th>Audiencia</th></tr></thead>
<tbody>
<tr><td><b>H0 Presentación conceptual</b></td><td>Mar-Abr 2026</td><td>Demo de un tubo + pitch para inversores/instituciones</td><td>Privada / Institucional</td></tr>
<tr><td><b>H1 Demo Meyer Sound Sevilla</b></td><td>May-Jun 2026</td><td>Demostración del modelo de síntesis modal con espacialización WFS y VBAP en las instalaciones de Meyer Sound (Sevilla). Prueba de concepto sonoro y espacial seguida de una presentación inmersiva con sonido 3D para contextualizar el proyecto</td><td>Público afín, inversores, instituciones</td></tr>
<tr><td><b>H2 Concierto inaugural</b></td><td>Jul 2026</td><td>Primera demo pública del instrumento digital con VBAP</td><td>Público especialista</td></tr>
<tr><td><b>H3 Bach en Vidrio</b></td><td>Oct-Nov 2026</td><td>Concierto residencia organista Bach, nuevos registros, WFS completo</td><td>Público general + prensa</td></tr>
<tr><td><b>Post-H3 Showcase técnico</b></td><td>Dic 2026</td><td>Demo de motores de síntesis y espacialización</td><td>IRCAM, centros de investigación</td></tr>
<tr><td><b>H5 Gira Portativo</b></td><td>Q1-Q2 2027</td><td>3-5 conciertos fuera de Uclés con 12-24 tubos</td><td>Festivales, auditorios</td></tr>
<tr><td><b>H5 Estreno obra original</b></td><td>Q2 2027</td><td>Estreno de la obra del compositor en residencia</td><td>Público general + compositores</td></tr>
<tr><td><b>H6 Conciertos de progreso</b></td><td>2027-2028</td><td>2-3/año mostrando evolución del instrumento</td><td>Público local + seguidores</td></tr>
<tr><td><b>H6 Bach completo en Vidrio</b></td><td>2028</td><td>Segunda residencia: registros para órgano de 150+ tubos</td><td>Público general + prensa internacional</td></tr>
<tr><td><b>H7 Concierto de integración</b></td><td>2028-2029</td><td>Gran concierto inaugural, órgano completo de 288 tubos</td><td>Evento internacional</td></tr>
<tr><td><b>H7 Festival de Creación Uclés</b></td><td>2029</td><td>Primera edición: residencias simultáneas, estrenos, masterclasses</td><td>Internacional</td></tr>
</tbody>
</table>
</div>

<!-- ═══ MODAL ═══ -->
<div class="modal-overlay" id="modal-overlay">
  <div class="modal">
    <button class="modal-close" onclick="closeModal()">&times;</button>
    <div id="modal-tag" class="modal-tag"></div>
    <h3 id="modal-title"></h3>
    <div id="modal-dates" class="dates"></div>
    <div id="modal-desc" class="desc"></div>
    <div id="modal-entregables" class="entregables" style="display:none">
      <h4>Entregables</h4>
      <p id="modal-entregables-text"></p>
    </div>
  </div>
</div>

<div class="footer">
  Órgano de Uclés · VITRAENON · Timeline del Proyecto · Generado <span id="fecha2"></span>
</div>

<script>
// ══════════════════════════════════════════════════════════════
// DATOS DEL PROYECTO
// ══════════════════════════════════════════════════════════════

// -- FASES (barras principales del Gantt) --
const FASES = [
  // === EJE TÉCNICO ===
  {id:"F1", nombre:"Modelo digital", inicio:"2026-02-01", fin:"2027-01-31", estado:"en_curso", grupo:"tecnico",
   desc:"Fase 1 del eje técnico: construcción completa del modelo digital del órgano. Incluye el motor modal escalado a 288 tubos, motor IR (NUPC), RAVE v1 training, integración SPAT+Dante, VBAP performer y WFS nave.",
   entregables:"Motor modal 288 tubos, motor IR, RAVE v1 entrenado, sistema VBAP 3D calibrado, array WFS frontal, interfaz MIDI, monitorización básica"},

  {id:"F1a", nombre:"Motor modal → 288", inicio:"2026-02-01", fin:"2026-04-30", estado:"en_curso", grupo:"tecnico_detalle",
   desc:"Escalado del motor de síntesis modal desde prototipo a los 288 tubos del órgano completo. Incluye parametrización de cada tubo según escenario dimensional seleccionado."},
  {id:"F1b", nombre:"Motor IR (NUPC)", inicio:"2026-05-01", fin:"2026-09-30", estado:"planificada", grupo:"tecnico_detalle",
   desc:"Desarrollo del motor de síntesis basado en impulse responses (IR). Non-Uniform Partitioned Convolution para eficiencia en tiempo real con IRs largas."},
  {id:"F1c", nombre:"RAVE v1 training", inicio:"2026-05-01", fin:"2026-09-30", estado:"planificada", grupo:"tecnico_detalle",
   desc:"Primer entrenamiento del modelo RAVE (Realtime Audio Variational autoEncoder) con muestras sintéticas generadas por el motor modal."},
  {id:"F1d", nombre:"SPAT + Dante integración", inicio:"2026-02-01", fin:"2026-05-31", estado:"en_curso", grupo:"tecnico_detalle",
   desc:"Integración del sistema de espacialización SPAT Revolution con red Dante para distribución de audio multicanal en la nave del monasterio."},
  {id:"F1e", nombre:"VBAP performer (H2)", inicio:"2026-06-01", fin:"2026-07-15", estado:"planificada", grupo:"tecnico_detalle",
   desc:"Implementación del performer VBAP (Vector Base Amplitude Panning) 3D para posicionamiento espacial de cada tubo virtual en el campo sonoro."},
  {id:"F1f", nombre:"WFS nave (H3)", inicio:"2026-08-01", fin:"2026-10-31", estado:"planificada", grupo:"tecnico_detalle",
   desc:"Instalación y calibración del array WFS (Wave Field Synthesis) frontal en la nave principal del monasterio de Uclés."},

  {id:"F2", nombre:"Órgano Portativo", inicio:"2026-08-01", fin:"2027-07-31", estado:"planificada", grupo:"tecnico",
   desc:"Fase 2: construcción del Órgano Portativo de Uclés. Primeros tubos reales con actuadores, bucle interno de control, y estructura portátil para 12-24 tubos que permita giras.",
   entregables:"Prototipo 6-12 tubos, sistema control Bela, calibración individual, RAVE v2 con datos reales, estructura portátil giratoria"},

  {id:"F2a", nombre:"Prototipo 6-12 tubos", inicio:"2026-10-01", fin:"2026-12-31", estado:"planificada", grupo:"tecnico_detalle",
   desc:"Fabricación y montaje de los primeros 6-12 tubos de vidrio DURAN 3.3 con actuadores electromagnéticos. Validación experimental del modelo acústico."},
  {id:"F2b", nombre:"Control inner loop (Bela)", inicio:"2026-09-01", fin:"2026-12-31", estado:"planificada", grupo:"tecnico_detalle",
   desc:"Implementación del bucle interno de control en plataforma Bela para feedback en tiempo real: excitación → micrófono → corrección → excitación."},
  {id:"F2c", nombre:"Calibración individual", inicio:"2027-01-01", fin:"2027-03-31", estado:"planificada", grupo:"tecnico_detalle",
   desc:"Proceso de calibración individual de cada tubo: medición de frecuencias reales, ajuste de parámetros del modelo, compensación de desviaciones."},
  {id:"F2d", nombre:"RAVE v2 (datos reales)", inicio:"2027-02-01", fin:"2027-05-31", estado:"planificada", grupo:"tecnico_detalle",
   desc:"Segundo entrenamiento de RAVE utilizando grabaciones reales de los tubos del prototipo. Mejora del timbre y la respuesta dinámica."},
  {id:"F2e", nombre:"Estructura portátil", inicio:"2027-02-01", fin:"2027-04-30", estado:"planificada", grupo:"tecnico_detalle",
   desc:"Diseño y fabricación de la estructura portátil para el Órgano Portativo: soporte para 12-24 tubos, sistema de espacialización compacto, giratoria."},

  {id:"F3", nombre:"Integración (288 tubos)", inicio:"2027-07-01", fin:"2029-01-31", estado:"planificada", grupo:"tecnico",
   desc:"Fase 3: integración progresiva hasta el órgano completo de 288 tubos. Fabricación por lotes, montaje progresivo, amplificación 200+ canales, y RAVE final con los 288 timbres reales.",
   entregables:"288 tubos instalados, 3 vías de síntesis (modal+IR+RAVE), espacialización WFS+VBAP completa, sistema de monitorización y mantenimiento"},

  {id:"F3a", nombre:"Fabricación por lotes (~258)", inicio:"2027-07-01", fin:"2028-06-30", estado:"planificada", grupo:"tecnico_detalle",
   desc:"Fabricación de los ~258 tubos restantes (tras los 30 del portativo) en lotes por registro. Corte a longitud, verificación dimensional, embalaje."},
  {id:"F3b", nombre:"Montaje progresivo", inicio:"2027-07-01", fin:"2028-12-31", estado:"planificada", grupo:"tecnico_detalle",
   desc:"Instalación progresiva de tubos en la estructura permanente del órgano. Registro por registro, con calibración incremental."},
  {id:"F3c", nombre:"Amplificación 200+ canales", inicio:"2027-07-01", fin:"2028-06-30", estado:"planificada", grupo:"tecnico_detalle",
   desc:"Infraestructura de amplificación para 200+ canales independientes: amplificadores clase D, red Dante, distribución de señal."},
  {id:"F3d", nombre:"RAVE final (288 timbres)", inicio:"2028-01-01", fin:"2028-06-30", estado:"planificada", grupo:"tecnico_detalle",
   desc:"Entrenamiento final del modelo RAVE con los 288 timbres reales grabados in situ. Modelo definitivo para síntesis neuronal."},
];

// -- HITOS (con duración, mostrados como barras) --
const HITOS = [
  {id:"H-1", nombre:"Investigación previa", inicio:"2025-11-01", fin:"2026-02-28", estado:"completada",
   desc:"Período de investigación previa al inicio formal del proyecto. Incluye el diseño conceptual del instrumento, estudios de viabilidad acústica, documentación técnica preliminar, demos preliminares de síntesis modal y primeros contactos con proveedores de vidrio.",
   entregables:"Documentación base, diseño conceptual, demos de síntesis preliminares, estudio de viabilidad acústica"},

  {id:"H0", nombre:"Presentación conceptual", inicio:"2026-03-01", fin:"2026-04-30", estado:"en_curso",
   desc:"Primer hito formal: demostración de un tubo de vidrio sonando con actuador electromagnético. Preparación de materiales de presentación para inversores e instituciones. Documentación formal del proyecto completada.",
   entregables:"Un tubo sonando, materiales de presentación, pitch deck, documentación formal N0/N1/N2"},

  {id:"H1", nombre:"Clon digital en directo", inicio:"2026-05-01", fin:"2026-06-30", estado:"planificada",
   desc:"Demostración previa de las capacidades del modelo de síntesis modal con un sistema de espacialización WFS y VBAP en las instalaciones de Meyer Sound en Sevilla. Además de la prueba de concepto sonoro y espacial, se realizará una presentación inmersiva con sonido 3D para contextualizar y conceptualizar el proyecto ante público afín, inversores e instituciones interesadas. Motor de síntesis modal escalado a los 288 tubos del órgano, funcionando en tiempo real. Interfaz MIDI operativa.",
   entregables:"Motor modal 288 tubos, interfaz MIDI, demo WFS+VBAP en Meyer Sound Sevilla, presentación inmersiva 3D, primera sesión de escucha"},

  {id:"H2", nombre:"Fachada + VBAP performer", inicio:"2026-07-01", fin:"2026-07-31", estado:"planificada",
   desc:"Fachada del órgano digital instalada en la nave del monasterio. Sistema VBAP 3D calibrado con array de altavoces. Consola Johannus integrada como interfaz de interpretación principal.",
   entregables:"Fachada instalada, VBAP 3D calibrado, consola Johannus integrada, primer concierto semi-privado"},

  {id:"H3", nombre:"WFS nave + concierto", inicio:"2026-10-01", fin:"2026-11-30", estado:"planificada",
   desc:"Array WFS (Wave Field Synthesis) frontal operativo en la nave del monasterio. Primer concierto público del instrumento digital con programa de Bach interpretado por organista en residencia.",
   entregables:"Array WFS frontal operativo, primer concierto público, programa de Bach, grabación del evento"},

  {id:"H4", nombre:"Primeros tubos sonando", inicio:"2026-11-01", fin:"2026-12-31", estado:"planificada",
   desc:"Primeros 6-12 tubos de vidrio reales con actuadores electromagnéticos funcionando. Bucle interno de control operativo (excitación-feedback). Validación experimental del modelo acústico.",
   entregables:"6-12 tubos con actuadores, bucle interno operativo, datos experimentales de validación"},

  {id:"H5", nombre:"Órgano Portativo de Uclés", inicio:"2027-01-01", fin:"2027-06-30", estado:"planificada",
   desc:"Órgano Portativo completo con 12-24 tubos de vidrio, estructura portátil giratoria, sistema de espacialización compacto. Listo para gira de 3-5 conciertos fuera de Uclés.",
   entregables:"12-24 tubos portátiles, espacialización compacta, estructura giratoria, programa de gira"},

  {id:"H6", nombre:"Instalación progresiva", inicio:"2027-07-01", fin:"2028-12-31", estado:"planificada",
   desc:"Instalación progresiva de tubos en la estructura permanente del órgano, registro por registro. Al final de este hito, 60-80% de los 288 tubos instalados y calibrados.",
   entregables:"60-80% tubos instalados, calibración incremental, conciertos de progreso semestrales"},

  {id:"H7", nombre:"Órgano completo", inicio:"2028-06-01", fin:"2029-01-31", estado:"planificada",
   desc:"Los 288 tubos de vidrio instalados y calibrados. Las tres vías de síntesis (modal, IR, RAVE neuronal) operativas simultáneamente. Espacialización WFS+VBAP completa. Inauguración oficial.",
   entregables:"288 tubos, 3 vías de síntesis, espacialización completa, concierto inaugural, Festival de Creación Uclés"},
];

// -- RESIDENCIAS --
const RESIDENCIAS = [
  {id:"R1", nombre:"Organista especialista en Bach", inicio:"2026-07-01", fin:"2026-11-15", fase:"F1",
   desc:"Residencia de 2-3 semanas. Explorar posibilidades del instrumento digital, crear registros tímbricos nuevos para repertorio de Bach. Culmina en concierto público (H3: Bach en Vidrio).",
   entregables:"Nuevos registros tímbricos, programa de Bach adaptado, concierto público H3"},
  {id:"R2", nombre:"Creador sonoro / Electroacústica", inicio:"2026-12-01", fin:"2026-12-31", fase:"F1",
   desc:"Residencia de 1-2 semanas. Explorar las tres vías de síntesis (modal, IR, RAVE), documentar posibilidades expresivas del instrumento digital más allá del repertorio tradicional.",
   entregables:"Documentación de posibilidades expresivas, piezas experimentales, showcase técnico"},
  {id:"R3", nombre:"Compositor contemporáneo", inicio:"2027-02-01", fin:"2027-05-31", fase:"F2",
   desc:"Residencia de 2-4 semanas. Componer obra original para el Órgano Portativo (12-24 tubos reales). Estreno en gira de conciertos fuera de Uclés.",
   entregables:"Obra original para Portativo, partitura, estreno en gira H5"},
  {id:"R4", nombre:"Investigador en acústica musical", inicio:"2026-11-01", fin:"2027-03-31", fase:"F2",
   desc:"Residencia de 1-2 semanas. Documentar acústica de los tubos de vidrio, medir modos de vibración reales, publicar resultados. Los datos sirven de entrenamiento para RAVE v2.",
   entregables:"Paper científico, datos acústicos medidos, dataset para RAVE v2"},
  {id:"R5", nombre:"Organista de repertorio contemporáneo", inicio:"2027-01-01", fin:"2027-04-30", fase:"F2",
   desc:"Residencia de 1-2 semanas. Preparar programa de gira con el Portativo, feedback técnico sobre interpretación con tubos reales, explorar interacción digital+físico.",
   entregables:"Programa de gira, feedback técnico, registro de sesiones"},
  {id:"R6", nombre:"Especialista en Bach (2ª visita)", inicio:"2028-03-01", fin:"2028-06-30", fase:"F3",
   desc:"Residencia de 3-4 semanas. Reorquestar Bach para el órgano de 150+ tubos, explorar nuevos registros masivos con WFS completa. Concierto de progreso.",
   entregables:"Registros masivos para 150+ tubos, programa de Bach ampliado, concierto de progreso"},
  {id:"R7", nombre:"Compositor en residencia (encargo)", inicio:"2028-06-01", fin:"2029-01-31", fase:"F3",
   desc:"Residencia larga de 4-8 semanas. Componer obra de gran formato que explore las tres vías de síntesis y la espacialización WFS completa. Estreno en inauguración H7.",
   entregables:"Obra de gran formato, partitura, estreno en inauguración H7"},
  {id:"R8", nombre:"Creador multidisciplinar", inicio:"2029-01-01", fin:"2029-03-31", fase:"F3",
   desc:"Residencia de 2-4 semanas. Combinar sonido, luz y movimiento. El órgano como instalación sonora total para el Festival de Creación Uclés.",
   entregables:"Pieza multidisciplinar, instalación sonora, performance para Festival"},
];

// ══════════════════════════════════════════════════════════════

const HOY = new Date();
const fmt = d => d.toLocaleDateString('es-ES',{day:'2-digit',month:'long',year:'numeric'});
document.getElementById('fecha').textContent = fmt(HOY);
document.getElementById('fecha2').textContent = fmt(HOY);

// ── Modal ──
function showModal(item, type) {
  const overlay = document.getElementById('modal-overlay');
  const tag = document.getElementById('modal-tag');
  const title = document.getElementById('modal-title');
  const dates = document.getElementById('modal-dates');
  const desc = document.getElementById('modal-desc');
  const entDiv = document.getElementById('modal-entregables');
  const entText = document.getElementById('modal-entregables-text');

  const colors = {
    hito: {bg:'#F3E5F5', color:'#7B1FA2'},
    fase: {bg:'#E8EAF6', color:'#1A237E'},
    residencia: {bg:'#E0F2F1', color:'#00695C'},
  };
  const c = colors[type] || colors.fase;
  tag.style.background = c.bg;
  tag.style.color = c.color;

  const typeLabels = {hito:'Hito', fase:'Fase', residencia:'Residencia'};
  tag.textContent = `${typeLabels[type] || type} · ${item.id}`;

  title.textContent = item.nombre;

  const fmtShort = s => {
    const d = new Date(s);
    return d.toLocaleDateString('es-ES', {month:'long', year:'numeric'});
  };
  dates.textContent = `${fmtShort(item.inicio)} → ${fmtShort(item.fin)}`;
  if (item.estado) {
    const stLabels = {completada:'Completado', en_curso:'En curso', planificada:'Planificado'};
    dates.textContent += ` · ${stLabels[item.estado] || item.estado}`;
  }

  desc.textContent = item.desc || '';

  if (item.entregables) {
    entDiv.style.display = '';
    entText.textContent = item.entregables;
  } else {
    entDiv.style.display = 'none';
  }

  overlay.classList.add('visible');
}

function closeModal() {
  document.getElementById('modal-overlay').classList.remove('visible');
}
document.getElementById('modal-overlay').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});
document.addEventListener('keydown', function(e) {
  if (e.key === 'Escape') closeModal();
});

// ── Toggle detail ──
let showDetail = false;

function toMs(s) {
  const q = s.match(/^(\d{4})-Q([1-4])$/);
  if (q) return new Date(+q[1], (+q[2]-1)*3, 1).getTime();
  return new Date(s).getTime();
}

function render() {
  const visibleFases = showDetail
    ? FASES
    : FASES.filter(f => !f.grupo.includes('_detalle'));

  // Compute time range from ALL data (fases + hitos + residencias)
  const allDates = [
    ...FASES.flatMap(f => [f.inicio, f.fin]),
    ...HITOS.flatMap(h => [h.inicio, h.fin]),
    ...RESIDENCIAS.flatMap(r => [r.inicio, r.fin]),
  ];
  const T0 = Math.min(...allDates.map(toMs));
  const T1 = Math.max(...allDates.map(toMs));
  const span = T1 - T0;
  const pct = d => ((toMs(d) - T0) / span * 100);
  const hoyPct = ((HOY.getTime() - T0) / span * 100);

  // Axis
  const axis = document.getElementById('axis');
  axis.innerHTML = '';
  let cur = new Date(T0);
  while (cur.getTime() <= T1 + 86400000) {
    const lbl = document.createElement('div');
    lbl.className = 'gantt-axis-label' + (cur.getMonth() === 0 ? ' year' : '');
    lbl.textContent = cur.getMonth() === 0 ? cur.getFullYear().toString() : cur.toLocaleDateString('es-ES',{month:'short'});
    axis.appendChild(lbl);
    cur.setMonth(cur.getMonth() + 1);
  }

  // Chart
  const chart = document.getElementById('gantt-chart');
  chart.innerHTML = '';

  function addSep(label) {
    const sep = document.createElement('div');
    sep.className = 'gantt-sep';
    sep.innerHTML = `<span>${label}</span><hr>`;
    chart.appendChild(sep);
  }

  // Map hitos to their parent phases by date overlap
  const HITO_FASE_MAP = {
    'H-1': null, // standalone
    'H0': 'F1', 'H1': 'F1', 'H2': 'F1', 'H3': 'F1',
    'H4': 'F2', 'H5': 'F2',
    'H6': 'F3', 'H7': 'F3',
  };

  function addRow(item, type, extraClass) {
    const row = document.createElement('div');
    row.className = 'gantt-row';

    const lbl = document.createElement('div');
    lbl.className = 'gantt-label';
    const isDetail = item.grupo && item.grupo.includes('_detalle');
    if (isDetail) {
      lbl.innerHTML = `<small style="padding-right:8px">\u21B3 ${item.nombre}</small>`;
    } else {
      lbl.innerHTML = `<strong>${item.id}</strong><small>${item.nombre}</small>`;
    }
    row.appendChild(lbl);

    const track = document.createElement('div');
    track.className = 'gantt-bar-track';

    // Today line
    const hoyLine = document.createElement('div');
    hoyLine.className = 'gantt-hoy';
    hoyLine.style.left = hoyPct + '%';
    track.appendChild(hoyLine);

    // Bar
    const left = pct(item.inicio);
    const right = pct(item.fin);
    const bar = document.createElement('div');
    const stateClass = item.estado || 'planificada';
    bar.className = `gantt-bar ${stateClass} ${extraClass || ''}`;
    bar.style.left = left + '%';
    bar.style.width = Math.max(0.5, right - left) + '%';
    bar.textContent = isDetail ? '' : item.id;
    if (isDetail) { bar.style.height = '14px'; bar.style.top = '10px'; bar.style.opacity = '0.7'; }
    bar.addEventListener('click', () => showModal(item, type));
    bar.title = `Clic para ver detalles de ${item.id}`;
    track.appendChild(bar);

    // Diamond markers: if this is a fase (F1/F2/F3), show ◆ for each hito that belongs to it
    if (type === 'fase' && !isDetail) {
      HITOS.forEach(h => {
        if (HITO_FASE_MAP[h.id] === item.id) {
          const diamond = document.createElement('div');
          diamond.className = 'gantt-diamond';
          diamond.textContent = '◆';
          diamond.style.left = pct(h.inicio) + '%';
          diamond.setAttribute('data-tooltip', `${h.id}: ${h.nombre}`);
          diamond.addEventListener('click', (e) => { e.stopPropagation(); showModal(h, 'hito'); });
          track.appendChild(diamond);
        }
      });
    }

    row.appendChild(track);
    chart.appendChild(row);
  }

  // ── EJE TÉCNICO ──
  addSep('Eje Técnico — Fases');
  let lastGrupo = '';
  visibleFases.forEach(fase => {
    const baseGrupo = fase.grupo.replace('_detalle','');
    if (baseGrupo === 'artistico') return; // skip, handled below
    addRow(fase, 'fase');
  });

  // ── HITOS ──
  addSep('Hitos (H-1 a H7)');
  HITOS.forEach(h => addRow(h, 'hito', 'hito-bar'));

  // ── EJE ARTÍSTICO / RESIDENCIAS ──
  addSep('Eje Artístico — Residencias');
  RESIDENCIAS.forEach(r => addRow(r, 'residencia', 'res-bar'));
}

render();

// Detail toggle
document.querySelector('.gantt-title').style.cursor = 'pointer';
document.querySelector('.gantt-title').addEventListener('click', () => {
  showDetail = !showDetail;
  document.querySelector('.gantt-title').textContent = showDetail
    ? 'Vista detallada — clic para contraer'
    : 'Planificación integrada (Nov 2025 – Ene 2029) — clic para expandir detalle';
  render();
});
document.querySelector('.gantt-title').textContent += ' — clic para expandir detalle';

// ── Hitos table (tab 2) ──
(function renderHitosTable(){
  const tbody = document.getElementById('hitos-tbody');
  HITOS.forEach(h => {
    const tr = document.createElement('tr');
    const stLabel = {completada:'done', en_curso:'now', planificada:'plan'}[h.estado];
    const stText = {completada:'Completado', en_curso:'En curso', planificada:'Planificado'}[h.estado];
    const fmtRange = () => {
      const s = new Date(h.inicio).toLocaleDateString('es-ES',{month:'short', year:'numeric'});
      const e = new Date(h.fin).toLocaleDateString('es-ES',{month:'short', year:'numeric'});
      return `${s} → ${e}`;
    };
    tr.innerHTML = `<td><b>${h.id}</b></td><td>${h.nombre}</td><td>${fmtRange()}</td><td><span class="badge ${stLabel}">${stText}</span></td><td>${h.entregables||''}</td>`;
    tr.addEventListener('click', () => showModal(h, 'hito'));
    tr.title = 'Clic para ver detalles';
    tbody.appendChild(tr);
  });
})();

// ── Residencias cards (tab 3) ──
(function renderResCards(){
  const grid = document.getElementById('res-grid');
  const faseColors = {F1:'var(--indigo)', F2:'var(--mid)', F3:'var(--light)'};
  RESIDENCIAS.forEach(r => {
    const card = document.createElement('div');
    card.className = 'res-card';
    card.style.borderLeftColor = faseColors[r.fase] || 'var(--mid)';
    const fmtRange = () => {
      const s = new Date(r.inicio).toLocaleDateString('es-ES',{month:'short', year:'numeric'});
      const e = new Date(r.fin).toLocaleDateString('es-ES',{month:'short', year:'numeric'});
      return `${s} – ${e}`;
    };
    card.innerHTML = `<div class="tag">${r.fase} · ${r.id} · ${fmtRange()}</div><h4>${r.nombre}</h4><p>${r.desc}</p>`;
    card.addEventListener('click', () => showModal(r, 'residencia'));
    card.title = 'Clic para ver detalles';
    grid.appendChild(card);
  });
})();

// Tab switching
function T(id) {
  document.querySelectorAll('.content').forEach(e => e.classList.remove('ac'));
  document.querySelectorAll('.tab').forEach(e => e.classList.remove('ac'));
  document.getElementById(id).classList.add('ac');
  event.target.classList.add('ac');
}
</script>
</body>
</html>
